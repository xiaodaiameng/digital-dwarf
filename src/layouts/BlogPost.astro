---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import Snowfall from '../components/Snowfall.astro';
import ClickParticles from '../components/ClickParticles.astro';
type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;
---

<html lang="en">
	<head>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<BaseHead title={title} description={description} />
		<style>
			main {
				width: calc(100% - 2em);
				max-width: 100%;
				margin: 0;
			}
			.hero-image {
				width: 100%;
			}
			.hero-image img {
				display: block;



				margin: 0 auto;
				border-radius: 12px;
				box-shadow: var(--box-shadow);
			}
			.prose {
				width: 720px;
				max-width: calc(100% - 2em);
				margin: auto;
				padding: 1em;
				color: rgb(var(--gray-dark));
			}
			.title {
				margin-bottom: 1em;
				padding: 1em 0;
				text-align: center;
				line-height: 1;
			}
			.title h1 {
				margin: 0 0 0.5em 0;
			}
			.date {
				margin-bottom: 0.5em;
				color: rgb(var(--gray));
			}
			.last-updated-on {
				font-style: italic;
			}
			  /* ========== 新增的响应式样式 ========== */
  
  /* 1. 必须的：viewport meta标签（添加到<head>） */
  /* 注意：这个需要添加到<head>标签内，不是在<style>里 */
 
	/* ========== LaTeX公式换行设置 ========== */

/* 1. 公式容器设置 */
.katex-display {
  max-width: 100%;
  overflow-wrap: break-word !important;
  word-wrap: break-word !important;
  word-break: break-all !important;
  hyphens: auto !important;
}

/* 2. KaTeX内部元素允许换行 */
.katex {
  display: inline-block !important;
  max-width: 100% !important;
  overflow-x: visible !important;
  white-space: normal !important;
}

/* 3. KaTeX的子元素换行设置 */
.katex-html {
  display: inline !important;
  max-width: 100% !important;
  overflow-wrap: break-word !important;
}

/* 4. 数学符号容器 */
.katex .mord,
.katex .mop,
.katex .mbin,
.katex .mrel,
.katex .mopen,
.katex .mclose {
  display: inline !important;
  white-space: normal !important;
}

/* 5. 文本部分（特别是中文） */
.katex .mord.text {
  font-family: inherit !important;
  white-space: normal !important;
}

/* 6. 针对手机屏幕的特殊设置 */
@media screen and (max-width: 768px) {
  .katex-display {
    font-size: 0.95em !important;
    padding: 0.5rem !important;
    margin: 0.5rem 0 !important;
  }
  
  .katex {
    font-size: 0.95em !important;
  }
  
  /* 强制换行的更强设置 */
  .katex .base {
    display: inline !important;
    white-space: normal !important;
  }
  
  .katex .mtable {
    max-width: 100% !important;
    overflow-x: auto !important;
    display: block !important;
  }
}

/* 7. 特别长的公式添加背景和边框以便识别 */
.katex-display {
  background-color: rgba(248, 249, 250, 0.7);
  border-radius: 8px;
  padding: 1rem;
  margin: 1rem 0;
  border-left: 4px solid #4dabf7;
}

  /* 2. 基础响应式设置 */
  html {
    font-size: 16px;
  }
  
  body {
    overflow-x: hidden;
    max-width: 100vw;
  }
  
  /* 3. 手机端适配（768px以下） */
  @media screen and (max-width: 768px) {
    html {
      font-size: 15px;
    }
    
    main {
      width: calc(100% - 1rem);
      padding: 0 0.5rem;
    }
    
    .prose {
      width: 100%;
      max-width: 100%;
      padding: 0.5rem;
    }
    
    .title {
      padding: 0.5rem 0;
    }
    
    .title h1 {
      font-size: 1.8rem;
      line-height: 1.2;
    }
    
    /* 图片响应式 */
    .hero-image img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
    }
    
    /* 表格在小屏幕上滚动 */
    table {
      display: block;
      overflow-x: auto;
      white-space: nowrap;
      -webkit-overflow-scrolling: touch;
    }
    
    /* 代码块适应 */
    pre {
      max-width: 100%;
      overflow-x: auto;
      font-size: 0.9rem;
      padding: 0.75rem;
    }
    
    code {
      font-size: 0.9rem;
      word-break: break-word;
    }
  }
  
  /* 4. 小手机适配（480px以下） */
  @media screen and (max-width: 480px) {
    html {
      font-size: 14px;
    }
    
    main {
      width: 100%;
      padding: 0 0.25rem;
    }
    
    .prose {
      padding: 0.25rem;
    }
    
    .title h1 {
      font-size: 1.5rem;
      margin-bottom: 0.25rem;
    }
    
    .date {
      font-size: 0.9rem;
    }
    
    /* 更紧凑的间距 */
    h2, h3, h4 {
      margin-top: 1rem;
      margin-bottom: 0.5rem;
    }
    
    p, li {
      margin-bottom: 0.75rem;
    }
  }
  
  /* 5. 专门针对LaTeX公式的响应式 */
  /* KaTeX公式容器 */
  .katex-display {
    max-width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    margin: 1rem 0;
    padding: 1rem 0.5rem;
  }
  
  /* 长公式水平滚动 */
  .katex {
    font-size: 1.05em;
  }
  
  @media screen and (max-width: 768px) {
    .katex {
      font-size: 1em;
    }
    
    /* 关系代数表达式特殊处理 */
    .katex-display {
      padding: 0.75rem 0.25rem;
      background: rgba(0, 0, 0, 0.02);
      border-radius: 6px;
    }
    
    .katex .mord.text {
      font-size: 0.9em;
    }
  }
  
  /* 6. 超大屏幕适配（1200px以上） */
  @media screen and (min-width: 1200px) {
    .prose {
      width: 800px;
    }
  }
  
  /* 7. 防止内容溢出 */
  img, video, iframe {
    max-width: 100%;
    height: auto;
  }
  
  /* 8. 更好的触摸体验 */
  @media (hover: none) and (pointer: coarse) {
    /* 手机触摸设备 */
    button, 
    a, 
    [role="button"] {
      min-height: 44px;
      min-width: 44px;
    }
    
    /* 增加可点击区域 */
    .prose a {
      padding: 0.125rem 0;
    }
  }
</style>
		</style>
	</head>

	<body>
		<Header />
		<main>
			<article>
				<div class="hero-image">
					{heroImage && <Image width={1020} height={510} src={heroImage} alt="" />}
				</div>
				<div class="prose">
					<div class="title">
						<div class="date">
							<FormattedDate date={pubDate} />
							<!-- {
								updatedDate && (
									<div class="last-updated-on">
										Last updated on <FormattedDate date={updatedDate} />
									</div>
								)
							} -->
						</div>
						<h1>{title}</h1>
						<hr />
					</div>
					<slot />
				</div>
			</article>
		</main>
		<Footer />
		<Snowfall />
		<ClickParticles />
	</body>
</html>
