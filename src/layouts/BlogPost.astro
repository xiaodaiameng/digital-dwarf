---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import Snowfall from '../components/Snowfall.astro';
import ClickParticles from '../components/ClickParticles.astro';
type Props = CollectionEntry<'blog'>['data'];
// 如果不需要 updatedDate，可以只解构需要的属性..... 删去updatedDate
const { title, description, pubDate, heroImage } = Astro.props;
---

<html lang="en">
	<head>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<BaseHead title={title} description={description} />
		<style>
<style>
/* ========== 基础页面样式 ========== */
main {
  width: calc(100% - 2em);
  max-width: 100%;
  margin: 0;
}

.hero-image {
  width: 100%;
}

.hero-image img {
  display: block;
  margin: 0 auto;
  border-radius: 12px;
  box-shadow: var(--box-shadow);
}

.prose {
  width: 720px;
  max-width: calc(100% - 2em);
  margin: auto;
  padding: 1em;
  color: rgb(var(--gray-dark));
}

.title {
  margin-bottom: 1em;
  padding: 1em 0;
  text-align: center;
  line-height: 1;
}

.title h1 {
  margin: 0 0 0.5em 0;
}

.date {
  margin-bottom: 0.5em;
  color: rgb(var(--gray));
}

.last-updated-on {
  font-style: italic;
}

/* ========== LaTeX公式智能换行 ========== */
.katex-display {
  display: block !important;
  max-width: 100% !important;
  margin: 1.5rem 0.5rem !important;
  padding: 1.2rem !important;
  background-color: rgba(248, 249, 250, 0.8);
  border-radius: 10px;
  border-left: 4px solid #4dabf7;
  
  /* 智能换行设置 */
  overflow-wrap: break-all !important;
  word-wrap: break-all !important;
  word-break: break-all !important;
  white-space: normal !important;
  line-height: 1.6 !important;
}

.katex {
  display: inline-block !important;
  font-size: 1.15em !important;
  max-width: 100% !important;
  
  /* 允许在运算符和关系符处换行 */
  white-space: normal !important;
  line-height: inherit !important;
}

/* 扩展您的现有规则 */
.katex .mord + .mord,
.katex .mbin + .mord,
.katex .mbin + .mop,      /* 运算符后的大运算符 */
.katex .mbin + .mbin,     /* 运算符后的运算符 */
.katex .mrel + .mord,
.katex .mrel + .mop,
.katex .mrel + .mbin,
.katex .mpunct + .mord,
.katex .mpunct + .mop,
.katex .mpunct + .mbin,
.katex .mord + .mbin,     /* 普通符号后的运算符 */
.katex .mord + .mop,      /* 普通符号后的大运算符 */
.katex .mop + .mord,      /* 大运算符后的普通符号 */
.katex .mop + .mbin {     /* 大运算符后的运算符 */
  white-space: normal !important;
  /* 也可以添加一些视觉优化 */
  display: inline-block;
  max-width: 100%;
}

/* 在任何元素后都允许换行 */
.katex * + * {
  white-space: normal !important;
}


/* 文本部分特别处理 */
.katex .mord.text {
  font-family: inherit !important;
  font-size: 1.05em !important;
  letter-spacing: 0.02em !important;
  white-space: normal !important;
  word-break: keep-all !important;  /* 中文不拆分 */
}

/* 长公式增加垂直间距 */
.katex .base {
  display: inline !important;
  white-space: normal !important;
  margin-bottom: 0.3em !important;
}

/* 子表达式间距 */
.katex .mord + .mbin,
.katex .mord + .mrel {
  margin-left: 0.2em !important;
  margin-right: 0.2em !important;
}

/* ========== 基础响应式设置 ========== */
html {
  font-size: 16px;
}

body {
  overflow-x: hidden;
  max-width: 100vw;
}

/* ========== 手机端适配（768px以下） ========== */
@media screen and (max-width: 768px) {
  html {
    font-size: 15px;
  }
  
  main {
    width: calc(100% - 1rem);
    padding: 0 0.5rem;
  }
  
  .prose {
    width: 100%;
    max-width: 100%;
    padding: 0.5rem;
  }
  
  .title {
    padding: 0.5rem 0;
  }
  
  .title h1 {
    font-size: 1.8rem;
    line-height: 1.2;
  }
  
  /* 图片响应式 */
  .hero-image img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
  }
  
  /* 表格在小屏幕上滚动 */
  table {
    display: block;
    overflow-x: auto;
    white-space: nowrap;
    -webkit-overflow-scrolling: touch;
  }
  
  /* 代码块适应 */
  pre {
    max-width: 100%;
    overflow-x: auto;
    font-size: 0.9rem;
    padding: 0.75rem;
  }
  
  code {
    font-size: 0.9rem;
    word-break: break-word;
  }
  
  /* LaTeX公式手机端响应式 */
  .katex-display {
    padding: 1rem 0.8rem !important;
    margin: 1.2rem 0 !important;
    line-height: 1.7 !important;  /* 手机端增加行高 */
    font-size: 0.98em !important;
  }
  
  .katex {
    font-size: 1.05em !important;
  }
  
  /* 手机端更宽松的换行 */
  .katex .base {
    margin-bottom: 0.4em !important;
  }
  
  /* 中文文本在手机端稍大 */
  .katex .mord.text {
    font-size: 1.1em !important;
    padding: 0.1em 0 !important;
  }
}

/* ========== 小手机适配（480px以下） ========== */
@media screen and (max-width: 480px) {
  html {
    font-size: 14px;
  }
  
  main {
    width: 100%;
    padding: 0 0.25rem;
  }
  
  .prose {
    padding: 0.25rem;
  }
  
  .title h1 {
    font-size: 1.5rem;
    margin-bottom: 0.25rem;
  }
  
  .date {
    font-size: 0.9rem;
  }
  
  /* 更紧凑的间距 */
  h2, h3, h4 {
    margin-top: 1rem;
    margin-bottom: 0.5rem;
  }
  
  p, li {
    margin-bottom: 0.75rem;
  }
  
  /* LaTeX公式小屏幕响应式 */
  .katex-display {
    padding: 0.9rem 0.7rem !important;
    line-height: 1.8 !important;
  }
  
  /* 在小屏幕上允许更多地方换行 */
  .katex * {
    white-space: normal !important;
  }
  
  /* 避免公式太拥挤 */
  .katex .mord,
  .katex .mop {
    margin: 0.05em 0 !important;
  }
}

/* ========== 超大屏幕适配（1200px以上） ========== */
@media screen and (min-width: 1200px) {
  .prose {
    width: 800px;
  }
  
  /* LaTeX公式超大屏幕响应式 */
  .katex-display {
    max-width: 90% !important;
    margin-left: auto !important;
    margin-right: auto !important;
  }
}

/* ========== 防止内容溢出 ========== */
img, video, iframe {
  max-width: 100%;
  height: auto;
}

/* ========== 更好的触摸体验 ========== */
@media (hover: none) and (pointer: coarse) {
  /* 手机触摸设备 */
  button, 
  a, 
  [role="button"] {
    min-height: 44px;
    min-width: 44px;
  }
  
  /* 增加可点击区域 */
  .prose a {
    padding: 0.125rem 0;
  }
}
</style>
	</head>

	<body>
		<Header />
		<main>
			<article>
				<div class="hero-image">
					{heroImage && <Image width={1020} height={510} src={heroImage} alt="" />}
				</div>
				<div class="prose">
					<div class="title">
						<div class="date">
							<FormattedDate date={pubDate} />
							<!-- {
								updatedDate && (
									<div class="last-updated-on">
										Last updated on <FormattedDate date={updatedDate} />
									</div>
								)
							} -->
						</div>
						<h1>{title}</h1>
						<hr />
					</div>
					<slot />
				</div>
			</article>
		</main>
		<Footer />
		<Snowfall />
		<ClickParticles />
	</body>
</html>
